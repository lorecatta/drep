---
title: "Burden estimation"
author: "Lorenzo Cattarino"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{burden}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

This vignette explains how to use `drep` to translate an estimate of the force of infection of dengue to the corresponding number of infections, symptomatic infections (*cases*) and symptomatic infections requiring hospitalization (*hospitalized cases*). To do this we need:

The `population` of the data point will also be needed when calculating the $R_0$.

We first consider a data point from the `foi` dataset (see [vignette](https://mrc-ide.github.io/drep/articles/burden.html)), i.e. a `caseReport` force of infection estimate from Brazil:

```{r}
ind <- 75
lambda <- drep::foi[ind, "FOI"]
lambda
```

We extract the population of that data point (`pop_size`) and the age structure (`n_j`):

```{r}
id_0 <- drep::foi[ind, "ID_0"]
pop_size <- drep::foi[ind, "population"]
pop_size

age_s_data <- drep::age_structure
n_j <- age_s_data[age_s_data$ID_0 == id_0, 2:ncol(age_s_data)]
```

We then extract the lower and upper age limits (`l_lim` and `u_lim`) of the country age groups using the `get_age_band_bounds` function 

```{r}
age_band_tgs <- grep("band", names(age_s_data), value = TRUE)
age_band_bnds <- drep::get_age_band_bounds(age_band_tgs)
l_lim <- age_band_bnds[, 1]
u_lim <- age_band_bnds[, 2]
```

We can now calculate the total annual number of infections which correspond to `lambda`:

```{r}
n_infections <- drep::calculate_infections(lambda, n_j, u_lim, l_lim, pop_size)
n_infections
```

To calculate the number of cases and hospitalized cases, we need to define some additional paramaters including:

* the proportions of primary, secondary, and tertiary/quaternary infections which are symptomatic (`sym_weights`)
* the proportions of primary, secondary, and tertiary/quaternary cases which require hospitalization (`hosp_weights`)

```{r}
sym_weights <- c(0.45, 0.85, 0.15)
hosp_weights <- c(0.04, 0.1, 0.04)
```

Now we can calculate the number of cases:

```{r}
n_cases <- drep::calculate_cases(lambda, n_j, u_lim, l_lim, sym_weights, pop_size)
n_cases
```

and the number of hopsitalized cases:

```{r}
n_h_cases <- drep::calculate_hosp_cases(lambda, n_j, u_lim, l_lim, hosp_weights, sym_weights, pop_size)
n_h_cases
```
